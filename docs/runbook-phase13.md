# Phase 13: Google Calendar é€£æº - äºˆå®šå–å¾—ã¨è¡¨ç¤º

## ã“ã®Phaseã®ç›®æ¨™

Google Calendar API ã‚’ä½¿ã£ã¦äºˆå®šã‚’å–å¾—ã—ã€ã‚¢ãƒ—ãƒªã«è¡¨ç¤ºï¼š
- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸€è¦§ã®å–å¾—
- ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆäºˆå®šï¼‰ã®å–å¾—
- ä»Šæ—¥ã®äºˆå®šã‚’ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«è¡¨ç¤º
- **æœªåˆ†é¡ã‚¤ãƒ™ãƒ³ãƒˆã®è¡¨ç¤ºã¨ã‚¿ã‚¹ã‚¯åŒ–**

---

## ã€é‡è¦ã€‘ã‚¢ã‚¤ã‚¼ãƒ³ãƒãƒ¯ãƒ¼ãƒãƒˆãƒªã‚¯ã‚¹ï¼ˆ4è±¡é™ + 2ç‰¹æ®Šï¼‰

```
FDC ã¯ã€Œç·Šæ€¥åº¦ã€Ã—ã€Œé‡è¦åº¦ã€ã§4è±¡é™ã«åˆ†é¡ã—ã¾ã™ï¼š

                â”‚  ç·Šæ€¥              â”‚  ç·Šæ€¥ã§ãªã„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  é‡è¦          â”‚  â™  spadeï¼ˆé»’ï¼‰    â”‚  â™¥ heartï¼ˆèµ¤ï¼‰
                â”‚  ã™ãã‚„ã‚‹          â”‚  äºˆå®šã«å…¥ã‚Œå®Ÿè¡Œ
                â”‚  Do Now            â”‚  Schedule
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  é‡è¦ã§ãªã„    â”‚  â™¦ diamondï¼ˆé»„ï¼‰  â”‚  â™£ clubï¼ˆé’ï¼‰
                â”‚  ä»»ã›ã‚‹ï¼†è‡ªå‹•åŒ–    â”‚  æœªæ¥å‰µé€ 20%ã‚¿ã‚¤ãƒ 
                â”‚  Delegate          â”‚  Create Future
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ï¼‹2ã¤ã®ç‰¹æ®Šã‚«ãƒ†ã‚´ãƒªï¼š
  ğŸƒ joker        â†’ åˆ†é¡å¾…ã¡/ç‰¹æ®Šã‚¿ã‚¹ã‚¯
  â“ unclassified â†’ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰å–å¾—ã—ãŸã°ã‹ã‚Š

ã€ãƒ•ãƒ­ãƒ¼ã€‘
ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰å–å¾— â†’ ã€Œæœªåˆ†é¡ã€ã¨ã—ã¦ã‚¸ãƒ§ãƒ¼ã‚«ãƒ¼ã‚¾ãƒ¼ãƒ³ã«è¡¨ç¤º
                     â†’ ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§è±¡é™ã«åˆ†é¡
                     â†’ tasks ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜ï¼ˆsuit ã‚«ãƒ©ãƒ è¨­å®šï¼‰
```

**é‡è¦ãƒã‚¤ãƒ³ãƒˆ**:
- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®äºˆå®š â‰  FDC ã®ã‚¿ã‚¹ã‚¯
- ã€Œç·Šæ€¥åº¦Ã—é‡è¦åº¦ã€ã§åˆ†é¡ã™ã‚‹ã®ãŒ FDC ã®æ ¸å¿ƒæ©Ÿèƒ½
- åˆ†é¡ã™ã‚‹ã“ã¨ã§æ™‚é–“ã®ä½¿ã„æ–¹ãŒå¤‰ã‚ã‚‹

---

## ç¿’å¾—ã™ã‚‹æ–°ã—ã„æ¦‚å¿µ

- **Google Calendar API**: Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—ã™ã‚‹API
- **ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ID**: å„ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®è­˜åˆ¥å­ã€‚ãƒ¡ã‚¤ãƒ³ã¯ã€Œprimaryã€
- **ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³**: æ™‚åˆ»ã®åŸºæº–åœ°åŸŸã€‚æ—¥æœ¬ã¯ã€ŒAsia/Tokyoã€
- **RFC3339**: æ—¥æ™‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‚ã€Œ2025-12-08T10:00:00+09:00ã€
- **ã‚¢ã‚¤ã‚¼ãƒ³ãƒãƒ¯ãƒ¼ãƒãƒˆãƒªã‚¯ã‚¹**: ç·Šæ€¥åº¦Ã—é‡è¦åº¦ã§4è±¡é™ã«åˆ†é¡ã™ã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **Suitï¼ˆ4è±¡é™ï¼‰**: spadeï¼ˆã™ãã‚„ã‚‹ï¼‰ã€heartï¼ˆäºˆå®šã«å…¥ã‚Œå®Ÿè¡Œï¼‰ã€diamondï¼ˆä»»ã›ã‚‹ï¼‰ã€clubï¼ˆæœªæ¥å‰µé€ ï¼‰
- **EventCategory**: 4è±¡é™ + joker + unclassified ã®6ç¨®é¡
- **æœªåˆ†é¡ï¼ˆunclassifiedï¼‰**: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰å–å¾—ã—ãŸã°ã‹ã‚Šã§ã€ã¾ã è±¡é™ãŒæ±ºã¾ã£ã¦ã„ãªã„çŠ¶æ…‹

---

## å‰ææ¡ä»¶

- Phase 12 å®Œäº†ï¼ˆCalendar ã‚¹ã‚³ãƒ¼ãƒ—è¿½åŠ æ¸ˆã¿ã€provider_token ä¿å­˜æ¸ˆã¿ï¼‰
- Googleèªè¨¼ã§ãƒ­ã‚°ã‚¤ãƒ³ãŒå‹•ä½œã™ã‚‹çŠ¶æ…‹
- users ãƒ†ãƒ¼ãƒ–ãƒ«ã« google_access_token ãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹

### ã€é‡è¦ã€‘ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—

Google OAuth ã§ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã™ã‚‹ãŸã‚ã€ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ä»¥ä¸‹ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ ï¼š

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/login/page.tsx` ã® `handleGoogleLogin` é–¢æ•°

```typescript
const { error: authError } = await supabase.auth.signInWithOAuth({
  provider: 'google',
  options: {
    redirectTo: `${window.location.origin}/api/auth/callback`,
    queryParams: {
      access_type: 'offline',  // ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—
      prompt: 'consent',       // æ¯å›åŒæ„ç”»é¢è¡¨ç¤º
    },
    scopes: 'https://www.googleapis.com/auth/calendar.readonly https://www.googleapis.com/auth/calendar.events https://www.googleapis.com/auth/tasks',
  },
});
```

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | æ„å‘³ |
|-----------|------|
| `access_type=offline` | ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¦æ±‚ |
| `prompt=consent` | åŒæ„ç”»é¢ã‚’æ¯å›è¡¨ç¤ºï¼ˆæ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã‚‚ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ï¼‰ |

---

## Step 1: å‹å®šç¾©

### 1.1 Google Calendar å‹å®šç¾©

**ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/types/google-calendar.ts`

```typescript
/**
 * lib/types/google-calendar.ts
 *
 * Phase 13: Google Calendar API ã®å‹å®šç¾©
 */

/**
 * ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æƒ…å ±
 */
export interface GoogleCalendar {
  id: string;
  summary: string;  // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å
  description?: string;
  primary?: boolean;
  backgroundColor?: string;
  foregroundColor?: string;
  accessRole?: 'freeBusyReader' | 'reader' | 'writer' | 'owner';
}

/**
 * ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸€è¦§ãƒ¬ã‚¹ãƒãƒ³ã‚¹
 */
export interface GoogleCalendarListResponse {
  kind: string;
  etag: string;
  nextPageToken?: string;
  nextSyncToken?: string;
  items: GoogleCalendar[];
}

/**
 * ã‚¤ãƒ™ãƒ³ãƒˆã®æ—¥æ™‚æƒ…å ±
 */
export interface GoogleEventDateTime {
  dateTime?: string;  // RFC3339 å½¢å¼ï¼ˆæ™‚åˆ»ã‚ã‚Šï¼‰
  date?: string;      // çµ‚æ—¥ã‚¤ãƒ™ãƒ³ãƒˆã®å ´åˆï¼ˆYYYY-MM-DDï¼‰
  timeZone?: string;
}

/**
 * Google Calendar ã‚¤ãƒ™ãƒ³ãƒˆ
 */
export interface GoogleEvent {
  id: string;
  status?: 'confirmed' | 'tentative' | 'cancelled';
  htmlLink?: string;
  summary?: string;  // ã‚¤ãƒ™ãƒ³ãƒˆå
  description?: string;
  location?: string;
  start: GoogleEventDateTime;
  end: GoogleEventDateTime;
  recurrence?: string[];
  recurringEventId?: string;
  organizer?: {
    email?: string;
    displayName?: string;
    self?: boolean;
  };
  creator?: {
    email?: string;
    displayName?: string;
  };
  attendees?: Array<{
    email?: string;
    displayName?: string;
    responseStatus?: 'needsAction' | 'declined' | 'tentative' | 'accepted';
  }>;
  colorId?: string;
}

/**
 * ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ãƒ¬ã‚¹ãƒãƒ³ã‚¹
 */
export interface GoogleEventsListResponse {
  kind: string;
  etag: string;
  summary: string;
  updated: string;
  timeZone: string;
  accessRole: string;
  nextPageToken?: string;
  nextSyncToken?: string;
  items: GoogleEvent[];
}

/**
 * ã‚¢ãƒ—ãƒªå†…ã§ä½¿ç”¨ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ï¼ˆæ­£è¦åŒ–æ¸ˆã¿ï¼‰
 */
export interface CalendarEvent {
  id: string;
  googleEventId: string;
  calendarId: string;
  title: string;
  description?: string;
  location?: string;
  startTime: Date;
  endTime: Date;
  isAllDay: boolean;
  htmlLink?: string;
  // FDC åˆ†é¡ç”¨
  suit?: 'spade' | 'heart' | 'diamond' | 'club' | 'joker' | 'unclassified';
}

/**
 * Suitï¼ˆ4è±¡é™ + 2ç‰¹æ®Šï¼‰ã®å®šç¾©
 */
export type Suit = 'spade' | 'heart' | 'diamond' | 'club' | 'joker' | 'unclassified';

export const SUIT_INFO: Record<Suit, { label: string; emoji: string; color: string; description: string }> = {
  spade: {
    label: 'ã™ãã‚„ã‚‹',
    emoji: 'â™ ',
    color: '#1a1a1a',
    description: 'ç·Šæ€¥ Ã— é‡è¦ï¼šä»Šã™ãå®Ÿè¡Œ',
  },
  heart: {
    label: 'äºˆå®šã«å…¥ã‚Œå®Ÿè¡Œ',
    emoji: 'â™¥',
    color: '#dc2626',
    description: 'ç·Šæ€¥ã§ãªã„ Ã— é‡è¦ï¼šè¨ˆç”»çš„ã«å®Ÿè¡Œ',
  },
  diamond: {
    label: 'ä»»ã›ã‚‹ãƒ»è‡ªå‹•åŒ–',
    emoji: 'â™¦',
    color: '#f59e0b',
    description: 'ç·Šæ€¥ Ã— é‡è¦ã§ãªã„ï¼šå§”ä»»ãƒ»åŠ¹ç‡åŒ–',
  },
  club: {
    label: 'æœªæ¥å‰µé€ 20%',
    emoji: 'â™£',
    color: '#2563eb',
    description: 'ç·Šæ€¥ã§ãªã„ Ã— é‡è¦ã§ãªã„ï¼šå‰µé€ çš„æ´»å‹•',
  },
  joker: {
    label: 'åˆ†é¡å¾…ã¡',
    emoji: 'ğŸƒ',
    color: '#8b5cf6',
    description: 'ç‰¹æ®Šã‚¿ã‚¹ã‚¯ãƒ»è¦åˆ†é¡',
  },
  unclassified: {
    label: 'æœªåˆ†é¡',
    emoji: 'â“',
    color: '#6b7280',
    description: 'ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰å–å¾—ã€è¦åˆ†é¡',
  },
};
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] `lib/types/google-calendar.ts` ãŒä½œæˆã•ã‚ŒãŸ
- [ ] GoogleCalendar, GoogleEvent å‹ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] CalendarEvent å‹ï¼ˆã‚¢ãƒ—ãƒªå†…ç”¨ï¼‰ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] Suit å‹ã¨ SUIT_INFO ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹

---

## Step 2: Google Calendar API ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

### 2.1 Calendar API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `lib/server/google-calendar.ts`

```typescript
/**
 * lib/server/google-calendar.ts
 *
 * Phase 13: Google Calendar API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
 */

import { getValidAccessToken } from './google-tokens';
import type {
  GoogleCalendar,
  GoogleCalendarListResponse,
  GoogleEvent,
  GoogleEventsListResponse,
  CalendarEvent,
} from '@/lib/types/google-calendar';

const CALENDAR_API_BASE = 'https://www.googleapis.com/calendar/v3';
const TIMEZONE = 'Asia/Tokyo';

/**
 * Google Calendar API ã‚’å‘¼ã³å‡ºã™
 */
async function callCalendarApi<T>(
  userId: string,
  endpoint: string,
  params?: Record<string, string>
): Promise<T | null> {
  const accessToken = await getValidAccessToken(userId);
  if (!accessToken) {
    console.error('[Calendar API] No valid access token');
    return null;
  }

  const url = new URL(`${CALENDAR_API_BASE}${endpoint}`);
  if (params) {
    Object.entries(params).forEach(([key, value]) => {
      url.searchParams.set(key, value);
    });
  }

  const response = await fetch(url.toString(), {
    headers: {
      Authorization: `Bearer ${accessToken}`,
    },
  });

  if (!response.ok) {
    const errorText = await response.text();
    console.error('[Calendar API] Error:', response.status, errorText);
    return null;
  }

  return response.json();
}

/**
 * ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸€è¦§ã‚’å–å¾—
 */
export async function getCalendarList(userId: string): Promise<GoogleCalendar[]> {
  const response = await callCalendarApi<GoogleCalendarListResponse>(
    userId,
    '/users/me/calendarList'
  );

  if (!response?.items) {
    return [];
  }

  // æ›¸ãè¾¼ã¿æ¨©é™ãŒã‚ã‚‹ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ã¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
  return response.items.filter(
    (cal) => cal.accessRole === 'owner' || cal.accessRole === 'writer'
  );
}

/**
 * ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ã‚’å–å¾—
 */
export async function getEvents(
  userId: string,
  calendarId: string = 'primary',
  options: {
    timeMin?: Date;
    timeMax?: Date;
    maxResults?: number;
  } = {}
): Promise<GoogleEvent[]> {
  const now = new Date();
  const timeMin = options.timeMin || now;
  const timeMax = options.timeMax || new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000); // 1é€±é–“å¾Œ

  const params: Record<string, string> = {
    timeMin: timeMin.toISOString(),
    timeMax: timeMax.toISOString(),
    singleEvents: 'true',  // ç¹°ã‚Šè¿”ã—ã‚¤ãƒ™ãƒ³ãƒˆã‚’å±•é–‹
    orderBy: 'startTime',
    timeZone: TIMEZONE,
    maxResults: String(options.maxResults || 100),
  };

  const response = await callCalendarApi<GoogleEventsListResponse>(
    userId,
    `/calendars/${encodeURIComponent(calendarId)}/events`,
    params
  );

  if (!response?.items) {
    return [];
  }

  // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆã‚’é™¤å¤–
  return response.items.filter((event) => event.status !== 'cancelled');
}

/**
 * ä»Šæ—¥ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—
 */
export async function getTodayEvents(
  userId: string,
  calendarId: string = 'primary'
): Promise<GoogleEvent[]> {
  const now = new Date();
  const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0);
  const endOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);

  return getEvents(userId, calendarId, {
    timeMin: startOfDay,
    timeMax: endOfDay,
  });
}

/**
 * GoogleEvent ã‚’ CalendarEvent ã«å¤‰æ›
 */
export function normalizeEvent(event: GoogleEvent, calendarId: string): CalendarEvent {
  const isAllDay = !event.start.dateTime;

  let startTime: Date;
  let endTime: Date;

  if (isAllDay) {
    // çµ‚æ—¥ã‚¤ãƒ™ãƒ³ãƒˆ
    startTime = new Date(event.start.date + 'T00:00:00');
    endTime = new Date(event.end.date + 'T00:00:00');
  } else {
    startTime = new Date(event.start.dateTime!);
    endTime = new Date(event.end.dateTime!);
  }

  return {
    id: `gcal_${calendarId}_${event.id}`,
    googleEventId: event.id,
    calendarId,
    title: event.summary || '(ã‚¿ã‚¤ãƒˆãƒ«ãªã—)',
    description: event.description,
    location: event.location,
    startTime,
    endTime,
    isAllDay,
    htmlLink: event.htmlLink,
    suit: 'unclassified',  // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰å–å¾—ã—ãŸã‚¤ãƒ™ãƒ³ãƒˆã¯æœªåˆ†é¡
  };
}

/**
 * è¤‡æ•°ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—ã—ã¦çµ±åˆ
 */
export async function getEventsFromAllCalendars(
  userId: string,
  options: {
    timeMin?: Date;
    timeMax?: Date;
    maxResults?: number;
  } = {}
): Promise<CalendarEvent[]> {
  const calendars = await getCalendarList(userId);
  if (calendars.length === 0) {
    return [];
  }

  const allEvents: CalendarEvent[] = [];

  for (const calendar of calendars) {
    const events = await getEvents(userId, calendar.id, options);
    const normalized = events.map((e) => normalizeEvent(e, calendar.id));
    allEvents.push(...normalized);
  }

  // é–‹å§‹æ™‚åˆ»ã§ã‚½ãƒ¼ãƒˆ
  allEvents.sort((a, b) => a.startTime.getTime() - b.startTime.getTime());

  return allEvents;
}
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] `lib/server/google-calendar.ts` ãŒä½œæˆã•ã‚ŒãŸ
- [ ] getCalendarList é–¢æ•°ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] getEvents é–¢æ•°ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] getTodayEvents é–¢æ•°ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] normalizeEvent é–¢æ•°ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹

---

## Step 3: API Routes å®Ÿè£…

### 3.1 ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸€è¦§ API

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/api/google/calendars/route.ts`

```typescript
/**
 * app/api/google/calendars/route.ts
 *
 * Phase 13: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸€è¦§å–å¾— API
 */

import { NextRequest, NextResponse } from 'next/server';
import { validateSession } from '@/lib/server/auth';
import { getCalendarList } from '@/lib/server/google-calendar';

export const dynamic = 'force-dynamic';

export async function GET(request: NextRequest) {
  try {
    const sessionToken = request.cookies.get('fdc_session')?.value;
    if (!sessionToken) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    const session = await validateSession(sessionToken);
    if (!session) {
      return NextResponse.json({ error: 'Invalid session' }, { status: 401 });
    }

    const calendars = await getCalendarList(session.userId);

    return NextResponse.json({
      calendars,
      count: calendars.length,
    });
  } catch (error) {
    console.error('Error in GET /api/google/calendars:', error);
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}
```

### 3.2 ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ API

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/api/google/calendars/events/route.ts`

```typescript
/**
 * app/api/google/calendars/events/route.ts
 *
 * Phase 13: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆå–å¾— API
 */

import { NextRequest, NextResponse } from 'next/server';
import { validateSession } from '@/lib/server/auth';
import {
  getEvents,
  getTodayEvents,
  getEventsFromAllCalendars,
  normalizeEvent,
} from '@/lib/server/google-calendar';

export const dynamic = 'force-dynamic';

export async function GET(request: NextRequest) {
  try {
    const sessionToken = request.cookies.get('fdc_session')?.value;
    if (!sessionToken) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    const session = await validateSession(sessionToken);
    if (!session) {
      return NextResponse.json({ error: 'Invalid session' }, { status: 401 });
    }

    const { searchParams } = new URL(request.url);
    const calendarId = searchParams.get('calendarId') || 'primary';
    const range = searchParams.get('range') || 'today'; // today, week, month, custom
    const timeMin = searchParams.get('timeMin');
    const timeMax = searchParams.get('timeMax');
    const allCalendars = searchParams.get('allCalendars') === 'true';

    let events;

    if (allCalendars) {
      // å…¨ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰å–å¾—
      const options: { timeMin?: Date; timeMax?: Date } = {};

      if (range === 'today') {
        const now = new Date();
        options.timeMin = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0);
        options.timeMax = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);
      } else if (range === 'week') {
        const now = new Date();
        options.timeMin = now;
        options.timeMax = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
      } else if (range === 'month') {
        const now = new Date();
        options.timeMin = now;
        options.timeMax = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);
      } else if (timeMin && timeMax) {
        options.timeMin = new Date(timeMin);
        options.timeMax = new Date(timeMax);
      }

      events = await getEventsFromAllCalendars(session.userId, options);
    } else {
      // å˜ä¸€ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰å–å¾—
      if (range === 'today') {
        const rawEvents = await getTodayEvents(session.userId, calendarId);
        events = rawEvents.map((e) => normalizeEvent(e, calendarId));
      } else {
        const options: { timeMin?: Date; timeMax?: Date } = {};

        if (range === 'week') {
          const now = new Date();
          options.timeMin = now;
          options.timeMax = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
        } else if (range === 'month') {
          const now = new Date();
          options.timeMin = now;
          options.timeMax = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);
        } else if (timeMin && timeMax) {
          options.timeMin = new Date(timeMin);
          options.timeMax = new Date(timeMax);
        }

        const rawEvents = await getEvents(session.userId, calendarId, options);
        events = rawEvents.map((e) => normalizeEvent(e, calendarId));
      }
    }

    return NextResponse.json({
      events,
      count: events.length,
      range,
      calendarId: allCalendars ? 'all' : calendarId,
    });
  } catch (error) {
    console.error('Error in GET /api/google/calendars/events:', error);
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] `app/api/google/calendars/route.ts` ãŒä½œæˆã•ã‚ŒãŸ
- [ ] `app/api/google/calendars/events/route.ts` ãŒä½œæˆã•ã‚ŒãŸ
- [ ] range ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ today/week/month ãŒæŒ‡å®šã§ãã‚‹
- [ ] allCalendars ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§å…¨ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å–å¾—ãŒã§ãã‚‹

---

## Step 4: UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…

### 4.1 ã‚¤ãƒ™ãƒ³ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/_components/calendar/EventItem.tsx`

```typescript
/**
 * app/_components/calendar/EventItem.tsx
 *
 * Phase 13: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆè¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
 */

'use client';

import type { CalendarEvent, Suit } from '@/lib/types/google-calendar';
import { SUIT_INFO } from '@/lib/types/google-calendar';

interface EventItemProps {
  event: CalendarEvent;
  onClassify?: (eventId: string, suit: Suit) => void;
  compact?: boolean;
}

export function EventItem({ event, onClassify, compact = false }: EventItemProps) {
  const formatTime = (date: Date) => {
    return date.toLocaleTimeString('ja-JP', {
      hour: '2-digit',
      minute: '2-digit',
    });
  };

  const suitInfo = SUIT_INFO[event.suit || 'unclassified'];

  if (compact) {
    return (
      <div
        style={{
          display: 'flex',
          alignItems: 'center',
          gap: '8px',
          padding: '8px 12px',
          backgroundColor: 'var(--card-bg)',
          borderRadius: '6px',
          borderLeft: `3px solid ${suitInfo.color}`,
        }}
      >
        <span style={{ fontSize: '12px', color: 'var(--text-light)', minWidth: '50px' }}>
          {event.isAllDay ? 'çµ‚æ—¥' : formatTime(event.startTime)}
        </span>
        <span style={{ flex: 1, fontSize: '14px' }}>{event.title}</span>
        <span style={{ fontSize: '14px' }}>{suitInfo.emoji}</span>
      </div>
    );
  }

  return (
    <div
      style={{
        padding: '12px 16px',
        backgroundColor: 'var(--card-bg)',
        borderRadius: '8px',
        border: '1px solid var(--border)',
        borderLeft: `4px solid ${suitInfo.color}`,
      }}
    >
      <div style={{ display: 'flex', alignItems: 'flex-start', gap: '12px' }}>
        <div style={{ flex: 1 }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '4px' }}>
            <span style={{ fontWeight: 500, fontSize: '15px' }}>{event.title}</span>
            <span
              style={{
                fontSize: '12px',
                padding: '2px 6px',
                backgroundColor: suitInfo.color + '20',
                color: suitInfo.color,
                borderRadius: '4px',
              }}
            >
              {suitInfo.emoji} {suitInfo.label}
            </span>
          </div>

          <div style={{ fontSize: '13px', color: 'var(--text-light)' }}>
            {event.isAllDay ? (
              'çµ‚æ—¥'
            ) : (
              <>
                {formatTime(event.startTime)} - {formatTime(event.endTime)}
              </>
            )}
          </div>

          {event.location && (
            <div style={{ fontSize: '13px', color: 'var(--text-light)', marginTop: '4px' }}>
              ğŸ“ {event.location}
            </div>
          )}
        </div>

        {onClassify && event.suit === 'unclassified' && (
          <div style={{ display: 'flex', gap: '4px' }}>
            {(['spade', 'heart', 'diamond', 'club'] as Suit[]).map((suit) => (
              <button
                key={suit}
                onClick={() => onClassify(event.id, suit)}
                title={SUIT_INFO[suit].description}
                style={{
                  width: '28px',
                  height: '28px',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  border: '1px solid var(--border)',
                  borderRadius: '4px',
                  backgroundColor: 'transparent',
                  cursor: 'pointer',
                  fontSize: '14px',
                }}
              >
                {SUIT_INFO[suit].emoji}
              </button>
            ))}
          </div>
        )}
      </div>
    </div>
  );
}
```

### 4.2 ä»Šæ—¥ã®äºˆå®šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/_components/calendar/TodaySchedule.tsx`

```typescript
/**
 * app/_components/calendar/TodaySchedule.tsx
 *
 * Phase 13: ä»Šæ—¥ã®äºˆå®šè¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
 */

'use client';

import { useState, useEffect } from 'react';
import type { CalendarEvent, Suit } from '@/lib/types/google-calendar';
import { EventItem } from './EventItem';

interface TodayScheduleProps {
  onClassify?: (eventId: string, suit: Suit) => void;
}

interface ApiCalendarEvent {
  id: string;
  googleEventId: string;
  calendarId: string;
  title: string;
  description?: string;
  location?: string;
  startTime: string;
  endTime: string;
  isAllDay: boolean;
  htmlLink?: string;
  suit?: 'spade' | 'heart' | 'diamond' | 'club' | 'joker' | 'unclassified';
}

export function TodaySchedule({ onClassify }: TodayScheduleProps) {
  const [events, setEvents] = useState<CalendarEvent[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    fetchTodayEvents();
  }, []);

  const fetchTodayEvents = async () => {
    try {
      setLoading(true);
      setError(null);

      const response = await fetch('/api/google/calendars/events?range=today&allCalendars=true');

      if (!response.ok) {
        if (response.status === 401) {
          setError('Google ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«æ¥ç¶šã•ã‚Œã¦ã„ã¾ã›ã‚“');
          return;
        }
        throw new Error('Failed to fetch events');
      }

      const data = await response.json();
      // Convert string dates to Date objects
      const convertedEvents: CalendarEvent[] = (data.events || []).map((e: ApiCalendarEvent) => ({
        ...e,
        startTime: new Date(e.startTime),
        endTime: new Date(e.endTime),
      }));
      setEvents(convertedEvents);
    } catch (err) {
      console.error('Error fetching today events:', err);
      setError('äºˆå®šã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
    } finally {
      setLoading(false);
    }
  };

  const today = new Date();
  const dateString = today.toLocaleDateString('ja-JP', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    weekday: 'long',
  });

  if (loading) {
    return (
      <div style={{ padding: '16px' }}>
        <div style={{ fontSize: '14px', color: 'var(--text-light)' }}>
          èª­ã¿è¾¼ã¿ä¸­...
        </div>
      </div>
    );
  }

  if (error) {
    return (
      <div style={{ padding: '16px' }}>
        <div style={{ fontSize: '14px', color: 'var(--danger)' }}>
          {error}
        </div>
      </div>
    );
  }

  return (
    <div>
      <div
        style={{
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'space-between',
          marginBottom: '12px',
        }}
      >
        <h3 style={{ margin: 0, fontSize: '16px' }}>
          ä»Šæ—¥ã®äºˆå®š
        </h3>
        <span style={{ fontSize: '13px', color: 'var(--text-light)' }}>
          {dateString}
        </span>
      </div>

      {events.length === 0 ? (
        <div
          style={{
            padding: '24px',
            textAlign: 'center',
            color: 'var(--text-light)',
            backgroundColor: 'var(--bg-muted)',
            borderRadius: '8px',
          }}
        >
          ä»Šæ—¥ã®äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“
        </div>
      ) : (
        <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
          {events.map((event) => (
            <EventItem
              key={event.id}
              event={event}
              onClassify={onClassify}
              compact
            />
          ))}
        </div>
      )}
    </div>
  );
}
```

### 4.3 æœªåˆ†é¡ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/_components/calendar/UnclassifiedEvents.tsx`

```typescript
/**
 * app/_components/calendar/UnclassifiedEvents.tsx
 *
 * Phase 13: æœªåˆ†é¡ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ï¼ˆè¦åˆ†é¡ï¼‰
 */

'use client';

import { useState, useEffect } from 'react';
import type { CalendarEvent, Suit } from '@/lib/types/google-calendar';
import { EventItem } from './EventItem';

interface UnclassifiedEventsProps {
  onClassify: (eventId: string, suit: Suit) => void;
}

interface ApiCalendarEvent {
  id: string;
  googleEventId: string;
  calendarId: string;
  title: string;
  description?: string;
  location?: string;
  startTime: string;
  endTime: string;
  isAllDay: boolean;
  htmlLink?: string;
  suit?: 'spade' | 'heart' | 'diamond' | 'club' | 'joker' | 'unclassified';
}

export function UnclassifiedEvents({ onClassify }: UnclassifiedEventsProps) {
  const [events, setEvents] = useState<CalendarEvent[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchEvents();
  }, []);

  const fetchEvents = async () => {
    try {
      const response = await fetch('/api/google/calendars/events?range=week&allCalendars=true');
      if (response.ok) {
        const data = await response.json();
        // Convert string dates to Date objects and filter unclassified
        const convertedEvents: CalendarEvent[] = (data.events || [])
          .map((e: ApiCalendarEvent) => ({
            ...e,
            startTime: new Date(e.startTime),
            endTime: new Date(e.endTime),
          }))
          .filter((e: CalendarEvent) => e.suit === 'unclassified');
        setEvents(convertedEvents);
      }
    } catch (err) {
      console.error('Error fetching events:', err);
    } finally {
      setLoading(false);
    }
  };

  const handleClassify = (eventId: string, suit: Suit) => {
    // UIã‹ã‚‰å‰Šé™¤
    setEvents((prev) => prev.filter((e) => e.id !== eventId));
    // è¦ªã«é€šçŸ¥
    onClassify(eventId, suit);
  };

  if (loading) {
    return <div style={{ padding: '16px', color: 'var(--text-light)' }}>èª­ã¿è¾¼ã¿ä¸­...</div>;
  }

  if (events.length === 0) {
    return (
      <div
        style={{
          padding: '24px',
          textAlign: 'center',
          color: 'var(--text-light)',
          backgroundColor: 'var(--bg-muted)',
          borderRadius: '8px',
        }}
      >
        æœªåˆ†é¡ã®äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“
      </div>
    );
  }

  return (
    <div>
      <div style={{ marginBottom: '12px' }}>
        <h3 style={{ margin: 0, fontSize: '16px' }}>
          æœªåˆ†é¡ã®äºˆå®šï¼ˆ{events.length}ä»¶ï¼‰
        </h3>
        <p style={{ margin: '4px 0 0', fontSize: '13px', color: 'var(--text-light)' }}>
          4è±¡é™ã«åˆ†é¡ã—ã¦ã‚¿ã‚¹ã‚¯åŒ–ã—ã¾ã—ã‚‡ã†
        </p>
      </div>

      <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
        {events.map((event) => (
          <EventItem
            key={event.id}
            event={event}
            onClassify={handleClassify}
          />
        ))}
      </div>
    </div>
  );
}
```

### 4.4 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/_components/calendar/index.ts`

```typescript
/**
 * app/_components/calendar/index.ts
 *
 * Phase 13: Calendar ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
 */

export { EventItem } from './EventItem';
export { TodaySchedule } from './TodaySchedule';
export { UnclassifiedEvents } from './UnclassifiedEvents';
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] `app/_components/calendar/EventItem.tsx` ãŒä½œæˆã•ã‚ŒãŸ
- [ ] `app/_components/calendar/TodaySchedule.tsx` ãŒä½œæˆã•ã‚ŒãŸ
- [ ] `app/_components/calendar/UnclassifiedEvents.tsx` ãŒä½œæˆã•ã‚ŒãŸ
- [ ] `app/_components/calendar/index.ts` ãŒä½œæˆã•ã‚ŒãŸ

---

## Step 5: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ä»Šæ—¥ã®äºˆå®šã‚’è¿½åŠ 

### 5.1 ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ã®æ›´æ–°

**ãƒ•ã‚¡ã‚¤ãƒ«**: `app/(app)/dashboard/page.tsx` ã«è¿½åŠ 

```typescript
// æ—¢å­˜ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«è¿½åŠ 
import { TodaySchedule } from '@/app/_components/calendar';

// JSX å†…ã®é©åˆ‡ãªå ´æ‰€ã«è¿½åŠ 
<div className="card" style={{ marginTop: '24px', padding: '20px' }}>
  <TodaySchedule />
</div>
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã« TodaySchedule ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ä»Šæ—¥ã®äºˆå®šãŒæ­£ã—ãå–å¾—ãƒ»è¡¨ç¤ºã•ã‚Œã‚‹

---

## Step 6: ãƒ“ãƒ«ãƒ‰ç¢ºèª

```bash
npm run build
```

### ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

- [ ] TypeScript ã‚¨ãƒ©ãƒ¼ãŒãªã„
- [ ] ãƒ“ãƒ«ãƒ‰ãŒæˆåŠŸã™ã‚‹

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: `[Calendar API] No valid access token`

**åŸå› **: ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ãŒæœŸé™åˆ‡ã‚Œã§ã€ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ãŒãªã„

**è§£æ±ºæ–¹æ³•**:
1. ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã« `access_type=offline` ã¨ `prompt=consent` ã‚’è¿½åŠ ï¼ˆStep 0 å‚ç…§ï¼‰
2. ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§å†ãƒ­ã‚°ã‚¤ãƒ³
3. Google ã®åŒæ„ç”»é¢ã§è¨±å¯

### ã‚¨ãƒ©ãƒ¼: `invalid request: both auth code and code verifier should be non-empty`

**åŸå› **: PKCE ã® code_verifier ãŒ Cookie ã«ä¿å­˜ã•ã‚Œã¦ã„ãªã„

**è§£æ±ºæ–¹æ³•**:
1. ãƒ–ãƒ©ã‚¦ã‚¶ã® Cookie ã‚’ã‚¯ãƒªã‚¢
2. ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ http://localhost:3000/login ã‚’é–‹ã
3. ã€ŒGoogle ã§ãƒ­ã‚°ã‚¤ãƒ³ã€ã‚’ã‚¯ãƒªãƒƒã‚¯

### äºˆå®šãŒè¡¨ç¤ºã•ã‚Œãªã„

**ç¢ºèªé …ç›®**:
1. `users` ãƒ†ãƒ¼ãƒ–ãƒ«ã« `google_access_token` ãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‹
2. `google_token_expires_at` ãŒæœªæ¥ã®æ—¥æ™‚ã‹
3. `google_refresh_token` ãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‹ï¼ˆé•·æœŸé‹ç”¨ã«å¿…è¦ï¼‰

---

## å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### å‹å®šç¾©

- [ ] `lib/types/google-calendar.ts` - Calendar API å‹å®šç¾©
- [ ] GoogleCalendar, GoogleEvent å‹
- [ ] CalendarEvent å‹ï¼ˆã‚¢ãƒ—ãƒªå†…ç”¨ï¼‰
- [ ] Suit å‹ã¨ SUIT_INFO å®šæ•°

### ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰

- [ ] `lib/server/google-calendar.ts` - Calendar API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
- [ ] getCalendarList - ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸€è¦§å–å¾—
- [ ] getEvents - ã‚¤ãƒ™ãƒ³ãƒˆå–å¾—
- [ ] getTodayEvents - ä»Šæ—¥ã®ã‚¤ãƒ™ãƒ³ãƒˆå–å¾—
- [ ] normalizeEvent - ã‚¤ãƒ™ãƒ³ãƒˆæ­£è¦åŒ–

### API Routes

- [ ] `app/api/google/calendars/route.ts` - ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸€è¦§
- [ ] `app/api/google/calendars/events/route.ts` - ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§

### UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

- [ ] `app/_components/calendar/EventItem.tsx` - ã‚¤ãƒ™ãƒ³ãƒˆè¡¨ç¤º
- [ ] `app/_components/calendar/TodaySchedule.tsx` - ä»Šæ—¥ã®äºˆå®š
- [ ] `app/_components/calendar/UnclassifiedEvents.tsx` - æœªåˆ†é¡ã‚¤ãƒ™ãƒ³ãƒˆ
- [ ] `app/_components/calendar/index.ts` - ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

### æ©Ÿèƒ½ç¢ºèª

- [ ] ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸€è¦§ãŒå–å¾—ã§ãã‚‹
- [ ] ã‚¤ãƒ™ãƒ³ãƒˆãŒå–å¾—ã§ãã‚‹
- [ ] ä»Šæ—¥ã®äºˆå®šãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆãŒã€Œæœªåˆ†é¡ã€ãƒãƒƒã‚¸ä»˜ãã§ã‚¸ãƒ§ãƒ¼ã‚«ãƒ¼ã‚¾ãƒ¼ãƒ³ã«è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] æœªåˆ†é¡ã‚¤ãƒ™ãƒ³ãƒˆã‚’è±¡é™ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§ãã‚‹ â†’ **Phase 14**
- [ ] è±¡é™ã‚’é¸ã‚“ã§ã‚¿ã‚¹ã‚¯åŒ–ã™ã‚‹ã¨ tasks ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜ã•ã‚Œã‚‹ â†’ **Phase 14**

### ç¿’å¾—ã—ãŸæ¦‚å¿µ

- [ ] Google Calendar API ã®ä½¿ã„æ–¹
- [ ] ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ID ã¨ primary ã®æ¦‚å¿µ
- [ ] RFC3339 æ—¥æ™‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
- [ ] ã‚¢ã‚¤ã‚¼ãƒ³ãƒãƒ¯ãƒ¼ãƒãƒˆãƒªã‚¯ã‚¹ï¼ˆ4è±¡é™ï¼‰
- [ ] Suit ã«ã‚ˆã‚‹åˆ†é¡ã‚·ã‚¹ãƒ†ãƒ 

---

## æ¬¡ã®Phase

Phase 14 ã§ã¯ã€åˆ†é¡ã—ãŸäºˆå®šã‚’ã‚¿ã‚¹ã‚¯ã¨ã—ã¦ä¿å­˜ã—ã€4è±¡é™ã®ã‚¿ã‚¹ã‚¯ãƒœãƒ¼ãƒ‰ã‚’å®Ÿè£…ã—ã¾ã™ï¼š

- ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§è±¡é™ã«åˆ†é¡
- ã‚¿ã‚¹ã‚¯ã¸ã®å¤‰æ›ãƒ»ä¿å­˜æ©Ÿèƒ½ï¼ˆsuit ã‚«ãƒ©ãƒ è¨­å®šï¼‰
- 4è±¡é™ã‚¿ã‚¹ã‚¯ãƒœãƒ¼ãƒ‰ UI
